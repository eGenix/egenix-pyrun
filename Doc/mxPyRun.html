<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
<HEAD>
    <TITLE>eGenix PyRun - One-file easy-to-install Python interpreter</TITLE>
</HEAD>

  <BODY TEXT="#000000" BGCOLOR="#FFFFFF" LINK="#0000EE" VLINK="#551A8B" ALINK="#FF0000">

    <HR NOSHADE WIDTH="100%">
    <H2>eGenix PyRun - One-file easy-to-install Python interpreter</H2>

    <HR SIZE=1 NOSHADE WIDTH="100%">
    <TABLE WIDTH="100%">
      <TR>
	<TD>
	  <SMALL>
	    <A HREF="#Install">Install</A> :
	    <A HREF="#Build">Build</A> :
	    <A HREF="#Contribute">Contribute</A> :
	    <A HREF="#Copyright">Copyright &amp; License</A> :
	    <A HREF="#History">History</A> :
	    <A HREF="" TARGET="_top">Home</A>
	</SMALL>
	</TD>
	<TD ALIGN=RIGHT>
	  <SMALL>
	    <FONT COLOR="#FF0000">Version 0.8.0</FONT>
	  </SMALL>
	</TD>
    </TABLE>
    <HR SIZE=1 NOSHADE WIDTH="100%">

    <H3>Introduction</H3>

    <UL CLASS="indent">

      <H4>CGI Programming with Python</H4>

      <P>
	If you are in the CGI scripting business, then you know how
	hard it can sometimes be getting the SysAdmins to install
	Python for you. I ran into such situations a few times.
	Fortunately it's not a big problem, if you can get a grip on a
	pre-compiled binary for the machine the ISP is running.
      <P>
	Since installing a complete package with many files through
	a FTP-only connection is not exactly fun, we need something
	different here. This were the freeze tool can help: with it
	you can wrap the interpreter together with the whole
	standard library and the builtin modules into one single
	file. All that remains is to FTP that binary to the ISP and
	off you go.
      <P>
	Ok, so much for the theory. Now where do you get that
	pre-compiled binary from ? That's where this campaign
	starts...
      <P>

      <H4>Other Usages</H4>

      <P>
	Note that the you can also use the provided setup files to
	create your own custom one-file interpreter for easy
	installation of Python at your site.
      <P>
	This may be an interesting alternative for those that don't
	want several different installations around. In that case, you
	may want to edit the included <TT>makepyrun.py</TT> script
	and the <TT>Modules/Setup</TT> file (which was adapted from the 
        Python source distribution) to produce a custom version that 
        suits your special needs.
      <P>
	Another interesting feature of the one-file interpreter is
	that startup time is reduced: all the libs are already
	available when the interpreter starts and thus no searching
	along filesystem paths is necessary.

      <A NAME="Notes"></A>

      <H4>Notes</H4>

	<P>
	  The encodings, email and distutils packages from Python
	  2.1.x were not included in the pyrun file in versions
	  using eGenix PyRun 0.5.0 and below. If you need codecs other
	  than 'utf-8' and 'ascii', you'll have to copy the encodings
	  package from the Python distribution to the same directory
	  where you place the pyrun binary.

	<P>
	  All standard packages except the test package are included
	  starting with eGenix PyRun 0.7.0 and up.

	<P>
	  Importing shared modules was fixed in eGenix PyRun 0.5.0.
	  eGenix PyRun now includes a patched version of the Python
	  freeze tools.

	<P>
	  If you want to use eGenix PyRun to compile versions of Python
	  2.3 and above, you'll need to edit the Modules/Setup and
	  change the line "new newmodule.c" to "#new newmodule.c".

	<P>
	  To compile on FreeBSD, you need to remove all occurences of
	  "unset PYTHONPATH;" in Makefile.cgi before starting the
	  compilation. Thanks to Oleg Broytmann for pointing out this
	  work-around.

    </UL><!--CLASS="indent"-->
	  
    <A NAME="Install"></A>

    <H3>Installing the one-file Python Interpreter</H3>

    <UL CLASS="indent">

      <P>
	To get your scripts to run on the ISP machine, you'll have to
	upload the interpreter binary via FTP and make it executable
	(I normally do this by uploading a small shell script into
	cgi-bin and then let the http daemon execute it... not exactly
	a very clean way, but what else can you do if you don't have
	telnet access ?).

      <P>
	To find out which machine your ISP is using, use the <TT>uname
	-a</TT> command (which you can either call directly using a
	telnet session or encapsuled in a small CGI script). Then go
	to the <A HREF="#Binaries">binaries section</A> and download
	the needed interpreter file for that platform. The eGenix PyRun
	archive includes a small Perl script <TT>uname.cgi</TT>
	(posted by Thomas A. Bryan to comp.lang.python in the thread
	"using python in www site", May 1999) that helps you find out
	the machine type. To run it, upload the script to your
	<TT>cgi-bin</TT> directory and then point your web-browser at
	it.

      <P>
	The interpreter binaries are gzipped to reduce network load.
	You can either gunzip them on the ISP's machine, or before
	uploading them using, e.g.
      <PRE>
      gunzip -N pyrun-2.1.2-Linux-2.4.2-i586-unknown.gz </PRE>
      This will turn the archive file back into a plain binary called
      <TT>pyrun</TT>.

      <P>
	You may also want to further compress the executable using a
	compressor such as <A
	HREF="http://wildsau.idv.uni-linz.ac.at/mfx/upx.html">UPX</A>
	before uploading it.  This can reduce the size of the
	executable from around 1.8MB to just about 600KB (for WinNT).

      <P>
	<U>Unix Target:</U>

      <P>
	Here is a step-by-step guide for installing a binary on your
	ISP account via FTP only. Note that you need a
	<TT>cgi-bin</TT> directory (or similar,
	e.g. <TT>cgi-local</TT>) that executes <TT>.cgi</TT> files as
	CGI scripts to have this work.

      <P>
      <OL>
	<LI> Create a new directory in your account's home dir, say
	  pythons/, using FTP (ftp myhost.isp.com; mkdir pythons)
	  <P>

	<LI> Find out the path to that directory (still in FTP: cd
	  pythons; pwd)
	  <P>

	<LI> Upload the un'gzipped pyrun binary (still in FTP:
	binary; put pyrun);
	  <P>

	<LI> Write a simple shell script install.cgi that sets the execute
	  flags (chmod 755) on 
	  <PRE>
/...full path to pyrun as noted in step 2/pyrun</PRE>
	  and put it into the cgi-bin dir, e.g. <PRE>
#!/bin/sh
chmod 755 /...full path to pyrun as noted in step 2/pyrun
</PRE>
	  <P>

	<LI> Use your browser to execute that script, e.g. point it to
	  http://myhost.isp.com/cgi-bin/install.cgi
	  <P>

	<LI> Delete the install.cgi shell script again (we don't want
	  keep this around for anyone to play with)
	  <P>

	<LI> Add the line 
	  <PRE>
#!/...full path to pyrun as noted in step 2/pyrun</PRE>
	  as first line to all your Python CGI scripts
	  <P>

	<LI> Upload the CGI scripts to the cgi-bin dir (they usually
	have to have an <TT>.cgi</TT> extension to become executable)
	  <P>

      </OL>

      <P>
	This should be all the steps you need to get Python up and
	running on your ISP account.

      <P>
	<B>
	  Note that you should not install the interpreter in the
	  <TT>cgi-bin</TT> directory of your account: use some other
	  secret directory. Installing it in <TT>cgi-bin</TT> would
	  compromise security as it permits executing any known Python
	  script on the ISP's machine.
	</B>

      <P>
	<U>Windows NT Target:</U>

      <P>
	These are some notes I received from <I>Florent Heyworth</I>
	about installing and using the pyrun interpreter on WinNT
	with IIS (slightly edited):

	<FONT SIZE="-1">

      <P>
	In order to get the Unix shebang "#!" functionality on NT 4.0
	running IIS 3.0 one should do the following (I tested this on
	Winnt 4.0 with IIS 3.0 although (I hope) the principle should
	hold true for IIS 4.0):

      <P>
	To make your scripts executable in the unix shebang style
	(note that you don't need the shebang "#!" in the script) you
	have to have access to the registry and enter the following
	string values in the registry node:
      <PRE>
  HKEY_LOCAL_MACHINE\SYSTEM\ControlSet001\Services\W3SVC\Parameters\Script Map

  key=.py value=path_to_executable %s %s
  key=.pyc value=path_to_executable %s %s
  key=.pyo value=path_to_executable %s %s
      </PRE>
as in:
      <PRE>
  .py c:\inetpub\scripts\pyrun.exe %s %s
  .pyc c:\inetpub\scripts\pyrun.exe %s %s
  .pyo c:\inetpub\scripts\pyrun.exe %s %s
      </PRE>

      <P>
	It is unlikely that a user will have access to the ISP host's
	registry however I include a .reg file taken from my own
	registry which you can supply to your ISP so that they can
	change the paths where appropriate (if they want to-
	applicable to IIS 3.0 only as I don't have a IIS 4.0
	installation handy) and merge it in their registry.  Note that
	merging (typically double-clicking) on the file will NOT
	overwrite existing keys (unless they already have values for
	.pyc,.py and .pyo files).

      <P>
	Note that the scripts should be placed in an area with only
	"execute" access and that the IIS 3.0 service should be
	stopped and then restarted. It's unfortunate that these steps
	can only be followed if the ISP "plays the game" - there are
	some hacks that one could use to go around that but it is not
	wise to circumvent one's provider... In the case where you
	don't have access to the host's registry or you don't want to
	involve him/her then your best best is including the full path
	to the script as in:
      <PRE>
  http://localhost/scripts/pyrun.exe?testboot.py
      </PRE>
      One of the easiest ways to get at the form variables is as in
      the following test case:
      <P>
	<FONT
	COLOR="#000099"><TT>\\localhost\inetpub\wwwroot\testit.html</TT></FONT>:
      <PRE>
"""
&lt;!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"&gt;
&lt;html&gt;
&lt;head&gt;
        &lt;title&gt;PyRun test&lt;/title&gt;
&lt;/head&gt;

&lt;body&gt;

&lt;FORM ACTION="../scripts/testboot.py" METHOD="POST"&gt;
&lt;INPUT TYPE="Text" NAME="TextInput"&gt;
&lt;INPUT NAME="Submit" VALUE="testboot.py" TYPE="SUBMIT"&gt;
&lt;/FORM&gt;

&lt;/body&gt;
&lt;/html&gt;
"""
      </PRE>
      and <FONT
      COLOR="#000099"><TT>\\localhost\inetpub\scripts\testboot.py</TT></FONT>:
      <PRE>
"""
import cgi

print 'Content-Type: text/html\n'

print '&lt;H2&gt;Directory:&lt;/H2&gt;'
import os
l = os.listdir('.')
for i in l:
    print '&lt;TT&gt; %s &lt;/TT&gt;&lt;BR&gt;' % i

# display executable passed to (hopefully) pyrun.exe
print '&lt;H2&gt;%s&lt;/H2&gt;' %sys.argv

# get all parameters passed in the form
form=cgi.FieldStorage()
cgi.print_form(form)

sys.exit(0)
"""
    </PRE>

      <P>
	Note that there is one small problem which is why I have
	uploaded a new version of pyrun.exe:

      <P>
	The windows initialisation prints to STDOUT "initialising
	(module name)" where module name is eg. "Pythoncom" or
	whatever [the code calls GetProcAddress for each of the
	possible Win32 extensions (which may not be available on the
	destination machine) and as such if there are not present will
	simply not initialize them].

      <P>
	This will not cause the CGI itself to fail, although one
	should not rely on these modules being present because if they
	were there is no way to get them to initialize as they'll
	typically be in an unreachable directory like winnt\system32
	or the standard Python installation root.

      <P>
	What could cause the CGI to fail in the end (Netscape is here
	less forgiving than IE) is that the code printed out to STDOUT
	"initializing (modulename)" will produce an invalid header
	response from Netscape and Netscape will try to get the user
	to download the response instead of displaying it in the
	browser. It is sufficient to just comment out the output code
	in dll_frozenmain.c.

      <P>
	I recommend renaming the PyRun.exe to PyRun.cgi and
	removing any "read","write" permissions in the
	directory. Additionally 8-) one has to remember to make the
	first line of the script one wants to execute print
	"Content-type: text/html"... But then we all know that 8-)

	</FONT>

    </UL><!--CLASS="indent"-->
	  
    <A NAME="Build"></A>

    <H3>Building the one-file Python Interpreter</H3>

    <UL CLASS="indent">
	<P>
	  I have put together a small zip file (see below for the
	  URL), which contains all necessary setup and config files.
	  Please also see the <A HREF="#Notes">Notes</A> section for
	  OS specific hints.
	  
	<P>
	  Here is what you have to do to compile a pyrun one-file-
	  does-it-all Python interpreter (alas, I don't know how this
	  is done on WinXX, these descriptions apply to Unix
	  installations -- which is what most ISPs use anyway):
	<P>
	<OL>
	  <LI>
	   Download the latest Python source distribution (if you
	   don't already have it).
	  <P>
	    Please always use a fresh copy of the distribution. This
	    ensures that all default modules are built static
	    (i.e. the code is included into the binary rather than
	    referenced as shared library) and a common setup is
	    available in all provided binaries.
	    <P>
	  <LI>
	    Download the <A HREF="egenix-pyrun-0.7.0.zip">eGenix PyRun
	    0.7.0</A> setup files for Python 2.1.x and above (or <A
	    HREF="egenix-pyrun-0.2.3.zip">eGenix PyRun 0.2.3</A> for
	    Python 1.5.2).
	    <P>
	  <LI>
	    Untar/zip the Python source distribution to some 
            temporary directory.
	    <P>
	  <LI>
	    Cd to the Python-x.x.x/ dir.
	    <P>
	  <LI>
	    Unzip the eGenix PyRun archive into the current directory; this
	    will not overwrite any distribution files, BTW.
	    <P>
	  <LI>
	    Run 'make -sf Makefile.cgi'.
	    <P>
	      Note that the build process uses a temporary subdir
	      (default is /tmp/pycgi) as build target. That subdir is
	      created if not existant and removed after successful
	      completion. <BR> You can change this target by passing a
	      parameter TARGETDIR=/my/tmp/dir/pyrun to the make
	      program, e.g.  'make -sf Makefile.cgi
	      TARGETDIR=/my/tmp/dir/pyrun'.
	    <P>
	  <LI>
	    Wait a few minutes, drink some coffee, go for walk, you
	    know what I mean...
	    <P>
	</OL>

	<P>E.g. a typical build session would look something like this
        (here for Python 1.5.2):
	<FONT COLOR="#000099"><PRE>
/home/lemburg> <B>cd tmp/</B>

lemburg/tmp> <B>tar xfz /downloads/python/py152.tgz</B>

lemburg/tmp> <B>cd Python-1.5.2/</B>

tmp/Python-1.5.2> <B>unzip /downloads/python/egenix-pyrun-0.2.3.zip</B>
Archive:  /downloads/python/egenix-pyrun-0.2.3.zip
  inflating: ./Makefile.cgi          
  inflating: ./README.PyRun    
  inflating: PyRun/makepyrun.py  
  inflating: PyRun/eGenix PyRun.html  
 extracting: PyRun/nop.py        
  inflating: PyRun/testboot.py   
  inflating: PyRun/testmod.py    

tmp/Python-1.5.2> <B>make -sf Makefile.cgi</B>
creating cache ./config.cache
checking MACHDEP... linux2
checking CCC... CCC= g++
[...]
creating config.h
making Makefile in subdirectory .
making Makefile in subdirectory Parser
making Makefile in subdirectory Objects
making Makefile in subdirectory Python
making Makefile in subdirectory Modules
[...]
Creating directory /tmp/pycgi//lib
Creating directory /tmp/pycgi//lib/python1.5
Creating directory /tmp/pycgi//lib/python1.5/config
Creating directory /tmp/pycgi//include
Creating directory /tmp/pycgi//include/python1.5
./install-sh -c -m 644 ./Include/Python.h /tmp/pycgi//include/python1.5
[...]
./install-sh -c -m 644 ./Include/tupleobject.h /tmp/pycgi//include/python1.5
making Makefile in subdirectory .
making Makefile in subdirectory Parser
making Makefile in subdirectory Objects
making Makefile in subdirectory Python
making Makefile in subdirectory Modules
Now run "make" in ../../PyRun to build the target: pyrun
--------------------------------------------------------------------------

Please send the file pyrun-1.5.2-Linux-2.0.35-i586-unknown.gz to

  pyrun@egenix.com

so that I can move the file to a central archive on our web-server
for everyone to download.

Thank you !

--------------------------------------------------------------------------

Finished. The interpreter is called: ./pyrun.
	</PRE></FONT>

	<P>
	  If all goes well, you'll find an executable file 'pyrun'
	  in the Python distribution directory. This file contains the
	  interpreter and the standard lib. It executes the first
	  command line argument as Python file, e.g.

	<PRE>
#!/path/to/pyrun
print 'Hello world!'
	</PRE>
	will work. It does *not* except any flags though, thus
	<PRE>
#!/path/to/pyrun -v
print 'Oops'
	</PRE>
	will not do, but then you normally don't need flags for CGI
	scripts.  The environment flags like PYTHONVERBOSE and
	PYTHONINSPECT still work as usual, though, so you can use
	those to get the modified behaviour.

	<P>
	  Note that the setup mechanism has only been tested on Linux,
	  so please verify that the resulting binary does work as
	  expected.
    </UL><!--CLASS="indent"-->
	  
    <A NAME="Contribute"></A>

    <H3>Making your contribution available to others</H3>

    <UL CLASS="indent">

        <P>
	  <B>PLEASE NOTE:</B> Due to time contraints we cannot
	  actively host eGenix PyRun binaries anymore.</B>

	<P>
	  We may restart this effort again in a few months. If you
	  want to contribute new files to the project, please send in
	  URLs to you eGenix PyRun binaries and we'll place them on
	  this page as references. Thank you.

<!--	  
	<P>
	  So, what do you think ? We'll need a place to collect the
	  binaries... I suggest emailing them to

        <BLOCKQUOTE><A
        HREF="mailto:pyrun@egenix.com">pyrun@egenix.com</A></BLOCKQUOTE>

	We'll then make them accessible for everybody via this page.

	<P>
	  Please use the archive prepared by the build process when
	  posting the file (it should include Python verion, OS
	  name/version and platform in the name),
	  e.g. <TT>pyrun-1.5.2-Linux-2.0.35-i586-unknown.gz</TT>.
	
        <P>
	  For some platforms it may also be necessary to specify
	  further configuration details in the EMail, like the version
	  of the used libc or other shared library dependencies.

	<P>
	  Thanks in advance to everyone who contributes :-)

-->

    </UL><!--CLASS="indent"-->
	  
    <A NAME="Copyright"></A>

    <H3>Copyright &amp; License</H3>

    <UL CLASS="indent">

	<P>
	  &copy; 1997-2000, Copyright by Marc-Andr&eacute; Lemburg;
	  All Rights Reserved.  mailto: <A
	  HREF="mailto:mal@lemburg.com">mal@lemburg.com</A>
	<P>
	  &copy; 2000-2011,  Copyright by eGenix.com Software GmbH,
	  Langenfeld, Germany; All Rights Reserved.  mailto: <A
	  HREF="mailto:info@egenix.com">info@egenix.com</A>

	<P> 
          This software is covered by the <A
	  HREF="mxLicense.html#Public"><B>eGenix.com Public License
	  Agreement</B></A>. The text of the license is also included as
	  file "LICENSE.PyRun" in the package's main directory.
          Part of the package (the directory PyRun/freeze/) contains
          software which is derived from Python 2.2. These parts
          fall under the Python 2.2 License which is inlcuded in the
          package's main directory as file "LICENSE.freeze".

	<P>
	  <B> By downloading, copying, installing or otherwise using
	  the software, you agree to be bound by the terms and
	  conditions of the eGenix.com Public License
	  Agreement and the Python 2.2 License. </B>

    </UL><!--CLASS="indent"-->

    <A NAME="History"></A>

    <H3>History & Future</H3>

    <UL CLASS="indent">

      <P>Things that still need to be done:

      <P><UL>

	<LI> Test the mechanism on all available platforms...

	  <P><LI> Provide as many compiled binaries as we can.

      </UL>

      <P>
	Changes from 0.7.0 to 0.8.0:
      <P>
      <UL>

	<LI> Ported eGenix PyRun to Python 2.5, 2.6 and 2.7.
	<LI> Enhanced the error reporting and command line interface.
	<LI> Added options to run byte-code and modules on the PYTHONPATH
	     directly.

      </UL>

      <P>
	Changes from 0.6.0 to 0.7.0:
      <P>
      <UL>

	<LI> Added all standard packages.

      </UL>

      <P>
	Changes from 0.5.0 to 0.6.0:
      <P>
      <UL>

	<LI> Added the encodings package.

      </UL>

      <P>
	Changes from 0.4.0 to 0.5.0:
      <P>
      <UL>

	<LI> Added patched freeze tool to enable loading shared
        modules with pyrun. Thanks to Martin v. Löwis for
        hinting me to the solution.

      </UL>

      <P>
	Changes from 0.2.3 to 0.4.0:
      <P>
      <UL>

	<LI> Updated to Python 2.1.x.

      </UL>

      <P>
	Changes from 0.2.2 to 0.2.3:
      <P>
      <UL>

	<LI> Updated links to starship.python.net.

	  <P><LI> Added note about UPX. Thanks to Neil Hodgson for
	  bringing it to my attention.

      </UL>

      <P>
	Changes from 0.2.1 to 0.2.2:
      <P>
      <UL>

	<LI> Minor cosmetics in the Makefile.

	  <P><LI> Added note to also mail othe configuration details.

	  <P><LI> Changed the shell script hacks for platform and
	  Python version to real Python scripts.

	  <P><LI> Added several new contributed binaries to the list.

      </UL>

      <P>
	Changes from 0.2.0 to 0.2.1:
      <P>
      <UL>

	<LI> Added a way to configure the temporary target directory used
	  by the Makefile.

	  <P><LI> Added targets to auto-generate uploadable and
	  properly versioned pyrun executables.

	  <P><LI> Added more documentation for the building process.

      </UL>

      <P>
	Changes from 0.1 to 0.2.0:
      <P>
      <UL>

	<LI> Made the setup code independent of the used Python
	  version. It should work with all version starting with
	  Python 1.5.

	  <P><LI>Simplified the make process.

      </UL>

      <P>

      <P>
	Version 0.1 was the initial release.

      <P>

    </UL><!--CLASS="indent"-->

    <HR WIDTH="100%">
    <CENTER><FONT SIZE=-1>
        <P>
          &copy; 1998-2000, Copyright by Marc-Andr&eacute; Lemburg;
          All Rights Reserved.  mailto: <A
          HREF="mailto:mal@lemburg.com">mal@lemburg.com</A>
        <P>
          &copy; 2000-2011,  Copyright by eGenix.com Software GmbH; 
          All Rights Reserved.  mailto: <A
          HREF="mailto:info@egenix.com">info@egenix.com</A>
    </FONT></CENTER>
    </FONT></CENTER>

  </BODY>
</HTML>
